#!/bin/bash

#
# Copyright (C) 2023 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

# helper to trigger users task. we need two arguments

action=${1:-}
localuser=${2:-}

# The UI expects a quick answer if started of failed to start, we cannot use podman directly here
if [[ "$action" == 'start' || "$action" == "restart" ]];then
    /usr/bin/systemctl --user "${action}" imapsync@${localuser}.service
# systemd does not trigger a stop signal if the task has not be started by systemd because the service is already stopped 
elif [[ "$action" == 'stop' ]];then
    /usr/bin/podman exec imapsync /usr/local/bin/syncctl stop "$localuser"
fi
